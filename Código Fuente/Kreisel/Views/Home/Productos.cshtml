@{
    ViewData["Title"] = "Productos";
}

<div class="container mt-4">
    <form method="get">
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Año</label>
                        <select class="form-select" name="anio" onchange="this.form.submit()">
                            @for (int year = 2000; year <= 2050; year++)
                            {
                                <option value="@year" selected="@(year == Model.AnioSeleccionado)">@year</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Categoría</label>
                        <select class="form-select" name="categoria" onchange="this.form.submit()">
                            <option value="" selected>-- Seleccione --</option>
                            @foreach (var categoria in Model.Categorias)
                            {
                                <option value="@categoria.Nombre"
                                        selected="@(categoria.Nombre == Model.CategoriaSeleccionada)">
                                    @categoria.Nombre
                                </option>
                            }
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <div class="card shadow-sm">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-light">
                        <tr>
                            <th width="5%">No.</th>
                            <th width="80%">Descripción Producto</th>
                            <th width="15%">Cantidad Vendida</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.Productos != null)
                        {
                            @foreach (var producto in Model.Productos)
                            {
                                <tr>
                                    <td>@producto.Numero</td>
                                    <td>@producto.Descripcion</td>
                                    <td>@producto.Cantidad</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<style>
    .table th {
        font-weight: 600;
    }

    .table-responsive {
        border-radius: 0.25rem;
    }
</style>

<script>
    $(document).ready(function() {

        function cargarCategorias(anio) {
            $.get('/Home/Productos', { anio: anio }, function(data) {
                var dropdown = $('#categoriaFilter');
                dropdown.empty();
                dropdown.append('<option value="" selected>-- Seleccione --</option>');

                $.each(data, function(index, categoria) {
                    dropdown.append($('<option></option>').val(categoria.nombre).text(categoria.nombre));
                });
            });
        }

        $('#anioFilter').change(function() {
            cargarCategorias($(this).val());
        });

        cargarCategorias(2019);
    });
</script>